
  <!DOCTYPE html>
  <html lang="en">
  <body>
  <script src="https://unpkg.com/gojs@3.0.0/release/go.js"></script>
  <p>
    This is a minimalist HTML and JavaScript skeleton of the GoJS Sample
    <a href="https://gojs.net/latest/samples/sequenceDiagram.html">sequenceDiagram.html</a>. It was automatically generated from a button on the sample page,
    and does not contain the full HTML. It is intended as a starting point to adapt for your own usage.
    For many samples, you may need to inspect the
    <a href="https://github.com/NorthwoodsSoftware/GoJS/blob/master/samples/sequenceDiagram.html">full source on Github</a>
    and copy other files or scripts.
  </p>
  <div id="allSampleContent" class="p-4 w-full">
          
            
            

<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet" type="text/css">
<script id="code">
  function init() {
    // Since 2.2 you can also author concise templates with method chaining instead of GraphObject.make
    // For details, see https://gojs.net/latest/intro/buildingObjects.html
    const $ = go.GraphObject.make;

    myDiagram = new go.Diagram(
      'myDiagramDiv', // must be the ID or reference to an HTML DIV
      {
        allowCopy: false,
        linkingTool: $(MessagingTool), // defined below
        'resizingTool.isGridSnapEnabled': true,
        draggingTool: $(MessageDraggingTool), // defined below
        'draggingTool.gridSnapCellSize': new go.Size(1, MessageSpacing / 4),
        'draggingTool.isGridSnapEnabled': true,
        // automatically extend Lifelines as Activities are moved or resized
        SelectionMoved: ensureLifelineHeights,
        PartResized: ensureLifelineHeights,
        'undoManager.isEnabled': true,
      }
    );

    // when the document is modified, add a "*" to the title and enable the "Save" button
    myDiagram.addDiagramListener('Modified', (e) => {
      const button = document.getElementById('SaveButton');
      if (button) button.disabled = !myDiagram.isModified;
      const idx = document.title.indexOf('*');
      if (myDiagram.isModified) {
        if (idx < 0) document.title += '*';
      } else {
        if (idx >= 0) document.title = document.title.slice(0, idx);
      }
    });

    // define the Lifeline Node template.
    myDiagram.groupTemplate = $(go.Group,
      'Vertical',
      {
        locationSpot: go.Spot.Bottom,
        locationObjectName: 'HEADER',
        minLocation: new go.Point(0, 0),
        maxLocation: new go.Point(9999, 0),
        selectionObjectName: 'HEADER',
      },
      new go.Binding('location', 'loc', go.Point.parse).makeTwoWay(go.Point.stringify),
      $(go.Panel,
        'Auto',
        { name: 'HEADER' },
        $(go.Shape, 'Rectangle', {
          fill: $(go.Brush, 'Linear', { 0: '#bbdefb', 1: go.Brush.darkenBy('#bbdefb', 0.1) }),
          stroke: null,
        }),
        $(go.TextBlock,
          {
            margin: 5,
            font: '400 10pt Source Sans Pro, sans-serif',
          },
          new go.Binding('text', 'text')
        )
      ),
      $(go.Shape,
        {
          figure: 'LineV',
          fill: null,
          stroke: 'gray',
          strokeDashArray: [3, 3],
          width: 1,
          alignment: go.Spot.Center,
          portId: '',
          fromLinkable: true,
          fromLinkableDuplicates: true,
          toLinkable: true,
          toLinkableDuplicates: true,
          cursor: 'pointer',
        },
        new go.Binding('height', 'duration', computeLifelineHeight)
      )
    );

    // define the Activity Node template
    myDiagram.nodeTemplate = $(go.Node,
      {
        locationSpot: go.Spot.Top,
        locationObjectName: 'SHAPE',
        minLocation: new go.Point(NaN, LinePrefix - ActivityStart),
        maxLocation: new go.Point(NaN, 19999),
        selectionObjectName: 'SHAPE',
        resizable: true,
        resizeObjectName: 'SHAPE',
        resizeAdornmentTemplate: $(go.Adornment,
          'Spot',
          $(go.Placeholder),
          $(go.Shape, // only a bottom resize handle
            {
              alignment: go.Spot.Bottom,
              cursor: 'col-resize',
              desiredSize: new go.Size(6, 6),
              fill: 'yellow',
            }
          )
        ),
      },
      new go.Binding('location', '', computeActivityLocation).makeTwoWay(backComputeActivityLocation),
      $(go.Shape,
        'Rectangle',
        {
          name: 'SHAPE',
          fill: 'white',
          stroke: 'black',
          width: ActivityWidth,
          // allow Activities to be resized down to 1/4 of a time unit
          minSize: new go.Size(ActivityWidth, computeActivityHeight(0.25)),
        },
        new go.Binding('height', 'duration', computeActivityHeight).makeTwoWay(backComputeActivityHeight)
      )
    );

    // define the Message Link template.
    myDiagram.linkTemplate = $(MessageLink, // defined below
      { selectionAdorned: true, curviness: 0 },
      $(go.Shape, 'Rectangle', { stroke: 'black' }),
      $(go.Shape, { toArrow: 'OpenTriangle', stroke: 'black' }),
      $(go.TextBlock,
        {
          font: '400 9pt Source Sans Pro, sans-serif',
          segmentIndex: 0,
          segmentOffset: new go.Point(NaN, NaN),
          isMultiline: false,
          editable: true,
        },
        new go.Binding('text', 'text').makeTwoWay()
      )
    );

    // create the graph by reading the JSON data saved in "mySavedModel" textarea element
    load();
  }

  function ensureLifelineHeights(e) {
    // iterate over all Activities (ignore Groups)
    const arr = myDiagram.model.nodeDataArray;
    let max = -1;
    for (let i = 0; i < arr.length; i++) {
      const act = arr[i];
      if (act.isGroup) continue;
      max = Math.max(max, act.start + act.duration);
    }
    if (max > 0) {
      // now iterate over only Groups
      for (let i = 0; i < arr.length; i++) {
        const gr = arr[i];
        if (!gr.isGroup) continue;
        if (max > gr.duration) {
          // this only extends, never shrinks
          myDiagram.model.setDataProperty(gr, 'duration', max);
        }
      }
    }
  }

  // some parameters
  const LinePrefix = 20; // vertical starting point in document for all Messages and Activations
  const LineSuffix = 30; // vertical length beyond the last message time
  const MessageSpacing = 20; // vertical distance between Messages at different steps
  const ActivityWidth = 10; // width of each vertical activity bar
  const ActivityStart = 5; // height before start message time
  const ActivityEnd = 5; // height beyond end message time

  function computeLifelineHeight(duration) {
    return LinePrefix + duration * MessageSpacing + LineSuffix;
  }

  function computeActivityLocation(act) {
    const groupdata = myDiagram.model.findNodeDataForKey(act.group);
    if (groupdata === null) return new go.Point();
    // get location of Lifeline's starting point
    const grouploc = go.Point.parse(groupdata.loc);
    return new go.Point(grouploc.x, convertTimeToY(act.start) - ActivityStart);
  }
  function backComputeActivityLocation(loc, act) {
    myDiagram.model.setDataProperty(act, 'start', convertYToTime(loc.y + ActivityStart));
  }

  function computeActivityHeight(duration) {
    return ActivityStart + duration * MessageSpacing + ActivityEnd;
  }
  function backComputeActivityHeight(height) {
    return (height - ActivityStart - ActivityEnd) / MessageSpacing;
  }

  // time is just an abstract small non-negative integer
  // here we map between an abstract time and a vertical position
  function convertTimeToY(t) {
    return t * MessageSpacing + LinePrefix;
  }
  function convertYToTime(y) {
    return (y - LinePrefix) / MessageSpacing;
  }

  // a custom routed Link
  class MessageLink extends go.Link {
    constructor() {
      super();
      this.time = 0; // use this "time" value when this is the temporaryLink
    }

    getLinkPoint(node, port, spot, from, ortho, othernode, otherport) {
      const p = port.getDocumentPoint(go.Spot.Center);
      const r = port.getDocumentBounds();
      const op = otherport.getDocumentPoint(go.Spot.Center);

      const data = this.data;
      const time = data !== null ? data.time : this.time; // if not bound, assume this has its own "time" property

      const aw = this.findActivityWidth(node, time);
      const x = op.x > p.x ? p.x + aw / 2 : p.x - aw / 2;
      const y = convertTimeToY(time);
      return new go.Point(x, y);
    }

    findActivityWidth(node, time) {
      let aw = ActivityWidth;
      if (node instanceof go.Group) {
        // see if there is an Activity Node at this point -- if not, connect the link directly with the Group's lifeline
        if (
          !node.memberParts.any((mem) => {
            const act = mem.data;
            return act !== null && act.start <= time && time <= act.start + act.duration;
          })
        ) {
          aw = 0;
        }
      }
      return aw;
    }

    getLinkDirection(node, port, linkpoint, spot, from, ortho, othernode, otherport) {
      const p = port.getDocumentPoint(go.Spot.Center);
      const op = otherport.getDocumentPoint(go.Spot.Center);
      const right = op.x > p.x;
      return right ? 0 : 180;
    }

    computePoints() {
      if (this.fromNode === this.toNode) {
        // also handle a reflexive link as a simple orthogonal loop
        const data = this.data;
        const time = data !== null ? data.time : this.time; // if not bound, assume this has its own "time" property
        const p = this.fromNode.port.getDocumentPoint(go.Spot.Center);
        const aw = this.findActivityWidth(this.fromNode, time);

        const x = p.x + aw / 2;
        const y = convertTimeToY(time);
        this.clearPoints();
        this.addPoint(new go.Point(x, y));
        this.addPoint(new go.Point(x + 50, y));
        this.addPoint(new go.Point(x + 50, y + 5));
        this.addPoint(new go.Point(x, y + 5));
        return true;
      } else {
        return super.computePoints();
      }
    }
  }
  // end MessageLink

  // A custom LinkingTool that fixes the "time" (i.e. the Y coordinate)
  // for both the temporaryLink and the actual newly created Link
  class MessagingTool extends go.LinkingTool {
    constructor() {
      super();

      // Since 2.2 you can also author concise templates with method chaining instead of GraphObject.make
      // For details, see https://gojs.net/latest/intro/buildingObjects.html
      const $ = go.GraphObject.make;
      this.temporaryLink = $(MessageLink,
        $(go.Shape, 'Rectangle', { stroke: 'magenta', strokeWidth: 2 }),
        $(go.Shape, { toArrow: 'OpenTriangle', stroke: 'magenta' })
      );
    }

    doActivate() {
      super.doActivate();
      const time = convertYToTime(this.diagram.firstInput.documentPoint.y);
      this.temporaryLink.time = Math.ceil(time); // round up to an integer value
    }

    insertLink(fromnode, fromport, tonode, toport) {
      const newlink = super.insertLink(fromnode, fromport, tonode, toport);
      if (newlink !== null) {
        const model = this.diagram.model;
        // specify the time of the message
        const start = this.temporaryLink.time;
        const duration = 1;
        newlink.data.time = start;
        model.setDataProperty(newlink.data, 'text', 'msg');
        // and create a new Activity node data in the "to" group data
        const newact = {
          group: newlink.data.to,
          start: start,
          duration: duration,
        };
        model.addNodeData(newact);
        // now make sure all Lifelines are long enough
        ensureLifelineHeights();
      }
      return newlink;
    }
  }
  // end MessagingTool

  // A custom DraggingTool that supports dragging any number of MessageLinks up and down --
  // changing their data.time value.
  class MessageDraggingTool extends go.DraggingTool {
    // override the standard behavior to include all selected Links,
    // even if not connected with any selected Nodes
    computeEffectiveCollection(parts, options) {
      const result = super.computeEffectiveCollection(parts, options);
      // add a dummy Node so that the user can select only Links and move them all
      result.add(new go.Node(), new go.DraggingInfo(new go.Point()));
      // normally this method removes any links not connected to selected nodes;
      // we have to add them back so that they are included in the "parts" argument to moveParts
      parts.each((part) => {
        if (part instanceof go.Link) {
          result.add(part, new go.DraggingInfo(part.getPoint(0).copy()));
        }
      });
      return result;
    }

    // override to allow dragging when the selection only includes Links
    mayMove() {
      return !this.diagram.isReadOnly && this.diagram.allowMove;
    }

    // override to move Links (which are all assumed to be MessageLinks) by
    // updating their Link.data.time property so that their link routes will
    // have the correct vertical position
    moveParts(parts, offset, check) {
      super.moveParts(parts, offset, check);
      const it = parts.iterator;
      while (it.next()) {
        if (it.key instanceof go.Link) {
          const link = it.key;
          const startY = it.value.point.y; // DraggingInfo.point.y
          let y = startY + offset.y; // determine new Y coordinate value for this link
          const cellY = this.gridSnapCellSize.height;
          y = Math.round(y / cellY) * cellY; // snap to multiple of gridSnapCellSize.height
          const t = Math.max(0, convertYToTime(y));
          link.diagram.model.set(link.data, 'time', t);
          link.invalidateRoute();
        }
      }
    }
  }
  // end MessageDraggingTool

  // Show the diagram's model in JSON format
  function save() {
    document.getElementById('mySavedModel').value = myDiagram.model.toJson();
    myDiagram.isModified = false;
  }
  function load() {
    myDiagram.model = go.Model.fromJson(document.getElementById('mySavedModel').value);
  }
  window.addEventListener('DOMContentLoaded', init);
</script>

<div id="sample">
  <div id="myDiagramDiv" style="border: 1px solid black; width: 100%; height: 400px; position: relative; -webkit-tap-highlight-color: rgba(255, 255, 255, 0); cursor: auto;"><canvas tabindex="0" width="1203" height="497" style="position: absolute; top: 0px; left: 0px; z-index: 2; user-select: none; touch-action: none; width: 963px; height: 398px; cursor: auto;"></canvas><div style="position: absolute; overflow: auto; width: 963px; height: 398px; z-index: 1;"><div style="position: absolute; width: 1px; height: 1px;"></div></div></div>
  <p>
    A <em>sequence diagram</em> is an interaction diagram that shows how entities operate with one another and in what order. In this sample, we show the
    interaction between different people in a restaurant.
  </p>
  <p>
    The diagram uses the <a href="../api/symbols/Diagram.html#groupTemplate" target="api">Diagram.groupTemplate</a> for "lifelines," <a href="../api/symbols/Diagram.html#nodeTemplate" target="api">Diagram.nodeTemplate</a> for "activities," and <a href="../api/symbols/Diagram.html#linkTemplate" target="api">Diagram.linkTemplate</a> for
    "messages" between the entities. Also featured are a custom Link class and custom <a href="../api/symbols/LinkingTool.html" target="api">LinkingTool</a> to draw links between lifelines and create activities
    at the end of the new link. Nodes use a binding function on the location property to ensure they are anchored to their lifeline.
  </p>
  <div>
    <div>
      <button id="SaveButton" onclick="save()" disabled="">Save</button>
      <button onclick="load()">Load</button>
      Diagram Model saved in JSON format:
    </div>
    <textarea id="mySavedModel" style="width: 100%; height: 240px">{ "class": "go.GraphLinksModel",
  "nodeDataArray": [
{"key":"Fred", "text":"Fred: Patron", "isGroup":true, "loc":"0 0", "duration":9},
{"key":"Bob", "text":"Bob: Waiter", "isGroup":true, "loc":"100 0", "duration":9},
{"key":"Hank", "text":"Hank: Cook", "isGroup":true, "loc":"200 0", "duration":9},
{"key":"Renee", "text":"Renee: Cashier", "isGroup":true, "loc":"300 0", "duration":9},
{"group":"Bob", "start":1, "duration":2},
{"group":"Hank", "start":2, "duration":3},
{"group":"Fred", "start":3, "duration":1},
{"group":"Bob", "start":5, "duration":1},
{"group":"Fred", "start":6, "duration":2},
{"group":"Renee", "start":8, "duration":1}
 ],
  "linkDataArray": [
{"from":"Fred", "to":"Bob", "text":"order", "time":1},
{"from":"Bob", "to":"Hank", "text":"order food", "time":2},
{"from":"Bob", "to":"Fred", "text":"serve drinks", "time":3},
{"from":"Hank", "to":"Bob", "text":"finish cooking", "time":5},
{"from":"Bob", "to":"Fred", "text":"serve food", "time":6},
{"from":"Fred", "to":"Renee", "text":"pay", "time":8}
 ]}
    </textarea>
  </div>
<p class="text-xs">GoJS version 3.0.0. Copyright 1998-2024 by Northwoods Software.</p></div>

          
        <p><a href="https://github.com/NorthwoodsSoftware/GoJS/blob/master/samples/sequenceDiagram.html" target="_blank">View this sample page's source on GitHub</a></p><pre class="language-js">
  <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Since 2.2 you can also author concise templates with method chaining instead of GraphObject.make</span>
    <span class="token comment">// For details, see https://gojs.net/latest/intro/buildingObjects.html</span>
    <span class="token keyword">const</span> $ <span class="token operator">=</span> go<span class="token punctuation">.</span>GraphObject<span class="token punctuation">.</span>make<span class="token punctuation">;</span>

    myDiagram <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Diagram</span><span class="token punctuation">(</span>
      <span class="token string">'myDiagramDiv'</span><span class="token punctuation">,</span> <span class="token comment">// must be the ID or reference to an HTML DIV</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">allowCopy</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">linkingTool</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>MessagingTool<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// defined below</span>
        <span class="token string-property property">'resizingTool.isGridSnapEnabled'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">draggingTool</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>MessageDraggingTool<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// defined below</span>
        <span class="token string-property property">'draggingTool.gridSnapCellSize'</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> MessageSpacing <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string-property property">'draggingTool.isGridSnapEnabled'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token comment">// automatically extend Lifelines as Activities are moved or resized</span>
        <span class="token literal-property property">SelectionMoved</span><span class="token operator">:</span> ensureLifelineHeights<span class="token punctuation">,</span>
        <span class="token literal-property property">PartResized</span><span class="token operator">:</span> ensureLifelineHeights<span class="token punctuation">,</span>
        <span class="token string-property property">'undoManager.isEnabled'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// when the document is modified, add a "*" to the title and enable the "Save" button</span>
    myDiagram<span class="token punctuation">.</span><span class="token function">addDiagramListener</span><span class="token punctuation">(</span><span class="token string">'Modified'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'SaveButton'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>button<span class="token punctuation">)</span> button<span class="token punctuation">.</span>disabled <span class="token operator">=</span> <span class="token operator">!</span>myDiagram<span class="token punctuation">.</span>isModified<span class="token punctuation">;</span>
      <span class="token keyword">const</span> idx <span class="token operator">=</span> document<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>myDiagram<span class="token punctuation">.</span>isModified<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> document<span class="token punctuation">.</span>title <span class="token operator">+=</span> <span class="token string">'*'</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> document<span class="token punctuation">.</span>title <span class="token operator">=</span> document<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// define the Lifeline Node template.</span>
    myDiagram<span class="token punctuation">.</span>groupTemplate <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Group<span class="token punctuation">,</span>
      <span class="token string">'Vertical'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">locationSpot</span><span class="token operator">:</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Bottom<span class="token punctuation">,</span>
        <span class="token literal-property property">locationObjectName</span><span class="token operator">:</span> <span class="token string">'HEADER'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minLocation</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxLocation</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">selectionObjectName</span><span class="token operator">:</span> <span class="token string">'HEADER'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">'location'</span><span class="token punctuation">,</span> <span class="token string">'loc'</span><span class="token punctuation">,</span> go<span class="token punctuation">.</span>Point<span class="token punctuation">.</span>parse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Point<span class="token punctuation">.</span>stringify<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Panel<span class="token punctuation">,</span>
        <span class="token string">'Auto'</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'HEADER'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">'Rectangle'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Brush<span class="token punctuation">,</span> <span class="token string">'Linear'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token string">'#bbdefb'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span> go<span class="token punctuation">.</span>Brush<span class="token punctuation">.</span><span class="token function">darkenBy</span><span class="token punctuation">(</span><span class="token string">'#bbdefb'</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
            <span class="token literal-property property">font</span><span class="token operator">:</span> <span class="token string">'400 10pt Source Sans Pro, sans-serif'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">figure</span><span class="token operator">:</span> <span class="token string">'LineV'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">'gray'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">strokeDashArray</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
          <span class="token literal-property property">alignment</span><span class="token operator">:</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Center<span class="token punctuation">,</span>
          <span class="token literal-property property">portId</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          <span class="token literal-property property">fromLinkable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">fromLinkableDuplicates</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">toLinkable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">toLinkableDuplicates</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token literal-property property">cursor</span><span class="token operator">:</span> <span class="token string">'pointer'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token string">'duration'</span><span class="token punctuation">,</span> computeLifelineHeight<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// define the Activity Node template</span>
    myDiagram<span class="token punctuation">.</span>nodeTemplate <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Node<span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">locationSpot</span><span class="token operator">:</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Top<span class="token punctuation">,</span>
        <span class="token literal-property property">locationObjectName</span><span class="token operator">:</span> <span class="token string">'SHAPE'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">minLocation</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">,</span> LinePrefix <span class="token operator">-</span> ActivityStart<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxLocation</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token number">19999</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">selectionObjectName</span><span class="token operator">:</span> <span class="token string">'SHAPE'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">resizable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">resizeObjectName</span><span class="token operator">:</span> <span class="token string">'SHAPE'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">resizeAdornmentTemplate</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Adornment<span class="token punctuation">,</span>
          <span class="token string">'Spot'</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Placeholder<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token comment">// only a bottom resize handle</span>
            <span class="token punctuation">{</span>
              <span class="token literal-property property">alignment</span><span class="token operator">:</span> go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Bottom<span class="token punctuation">,</span>
              <span class="token literal-property property">cursor</span><span class="token operator">:</span> <span class="token string">'col-resize'</span><span class="token punctuation">,</span>
              <span class="token literal-property property">desiredSize</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token string">'yellow'</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">'location'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> computeActivityLocation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span>backComputeActivityLocation<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span>
        <span class="token string">'Rectangle'</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'SHAPE'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">fill</span><span class="token operator">:</span> <span class="token string">'white'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">width</span><span class="token operator">:</span> ActivityWidth<span class="token punctuation">,</span>
          <span class="token comment">// allow Activities to be resized down to 1/4 of a time unit</span>
          <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Size</span><span class="token punctuation">(</span>ActivityWidth<span class="token punctuation">,</span> <span class="token function">computeActivityHeight</span><span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token string">'duration'</span><span class="token punctuation">,</span> computeActivityHeight<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span>backComputeActivityHeight<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// define the Message Link template.</span>
    myDiagram<span class="token punctuation">.</span>linkTemplate <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>MessageLink<span class="token punctuation">,</span> <span class="token comment">// defined below</span>
      <span class="token punctuation">{</span> <span class="token literal-property property">selectionAdorned</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">curviness</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">'Rectangle'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">'black'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">toArrow</span><span class="token operator">:</span> <span class="token string">'OpenTriangle'</span><span class="token punctuation">,</span> <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">'black'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>TextBlock<span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">font</span><span class="token operator">:</span> <span class="token string">'400 9pt Source Sans Pro, sans-serif'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">segmentIndex</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token literal-property property">segmentOffset</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token literal-property property">isMultiline</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          <span class="token literal-property property">editable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Binding</span><span class="token punctuation">(</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">makeTwoWay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// create the graph by reading the JSON data saved in "mySavedModel" textarea element</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">ensureLifelineHeights</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// iterate over all Activities (ignore Groups)</span>
    <span class="token keyword">const</span> arr <span class="token operator">=</span> myDiagram<span class="token punctuation">.</span>model<span class="token punctuation">.</span>nodeDataArray<span class="token punctuation">;</span>
    <span class="token keyword">let</span> max <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> act <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>act<span class="token punctuation">.</span>isGroup<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
      max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> act<span class="token punctuation">.</span>start <span class="token operator">+</span> act<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// now iterate over only Groups</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> gr <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>gr<span class="token punctuation">.</span>isGroup<span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">&gt;</span> gr<span class="token punctuation">.</span>duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// this only extends, never shrinks</span>
          myDiagram<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">setDataProperty</span><span class="token punctuation">(</span>gr<span class="token punctuation">,</span> <span class="token string">'duration'</span><span class="token punctuation">,</span> max<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// some parameters</span>
  <span class="token keyword">const</span> LinePrefix <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// vertical starting point in document for all Messages and Activations</span>
  <span class="token keyword">const</span> LineSuffix <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">// vertical length beyond the last message time</span>
  <span class="token keyword">const</span> MessageSpacing <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// vertical distance between Messages at different steps</span>
  <span class="token keyword">const</span> ActivityWidth <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// width of each vertical activity bar</span>
  <span class="token keyword">const</span> ActivityStart <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// height before start message time</span>
  <span class="token keyword">const</span> ActivityEnd <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// height beyond end message time</span>

  <span class="token keyword">function</span> <span class="token function">computeLifelineHeight</span><span class="token punctuation">(</span><span class="token parameter">duration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> LinePrefix <span class="token operator">+</span> duration <span class="token operator">*</span> MessageSpacing <span class="token operator">+</span> LineSuffix<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">computeActivityLocation</span><span class="token punctuation">(</span><span class="token parameter">act</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> groupdata <span class="token operator">=</span> myDiagram<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">findNodeDataForKey</span><span class="token punctuation">(</span>act<span class="token punctuation">.</span>group<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>groupdata <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// get location of Lifeline's starting point</span>
    <span class="token keyword">const</span> grouploc <span class="token operator">=</span> go<span class="token punctuation">.</span>Point<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>groupdata<span class="token punctuation">.</span>loc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>grouploc<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token function">convertTimeToY</span><span class="token punctuation">(</span>act<span class="token punctuation">.</span>start<span class="token punctuation">)</span> <span class="token operator">-</span> ActivityStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">backComputeActivityLocation</span><span class="token punctuation">(</span><span class="token parameter">loc<span class="token punctuation">,</span> act</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    myDiagram<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">setDataProperty</span><span class="token punctuation">(</span>act<span class="token punctuation">,</span> <span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token function">convertYToTime</span><span class="token punctuation">(</span>loc<span class="token punctuation">.</span>y <span class="token operator">+</span> ActivityStart<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">computeActivityHeight</span><span class="token punctuation">(</span><span class="token parameter">duration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> ActivityStart <span class="token operator">+</span> duration <span class="token operator">*</span> MessageSpacing <span class="token operator">+</span> ActivityEnd<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">backComputeActivityHeight</span><span class="token punctuation">(</span><span class="token parameter">height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>height <span class="token operator">-</span> ActivityStart <span class="token operator">-</span> ActivityEnd<span class="token punctuation">)</span> <span class="token operator">/</span> MessageSpacing<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// time is just an abstract small non-negative integer</span>
  <span class="token comment">// here we map between an abstract time and a vertical position</span>
  <span class="token keyword">function</span> <span class="token function">convertTimeToY</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> t <span class="token operator">*</span> MessageSpacing <span class="token operator">+</span> LinePrefix<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">convertYToTime</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> LinePrefix<span class="token punctuation">)</span> <span class="token operator">/</span> MessageSpacing<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// a custom routed Link</span>
  <span class="token keyword">class</span> <span class="token class-name">MessageLink</span> <span class="token keyword">extends</span> <span class="token class-name">go<span class="token punctuation">.</span>Link</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// use this "time" value when this is the temporaryLink</span>
    <span class="token punctuation">}</span>

    <span class="token function">getLinkPoint</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> port<span class="token punctuation">,</span> spot<span class="token punctuation">,</span> from<span class="token punctuation">,</span> ortho<span class="token punctuation">,</span> othernode<span class="token punctuation">,</span> otherport</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> p <span class="token operator">=</span> port<span class="token punctuation">.</span><span class="token function">getDocumentPoint</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Center<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> r <span class="token operator">=</span> port<span class="token punctuation">.</span><span class="token function">getDocumentBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> op <span class="token operator">=</span> otherport<span class="token punctuation">.</span><span class="token function">getDocumentPoint</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Center<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token keyword">const</span> time <span class="token operator">=</span> data <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">?</span> data<span class="token punctuation">.</span>time <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">;</span> <span class="token comment">// if not bound, assume this has its own "time" property</span>

      <span class="token keyword">const</span> aw <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findActivityWidth</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> x <span class="token operator">=</span> op<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> p<span class="token punctuation">.</span>x <span class="token operator">?</span> p<span class="token punctuation">.</span>x <span class="token operator">+</span> aw <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">:</span> p<span class="token punctuation">.</span>x <span class="token operator">-</span> aw <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">convertTimeToY</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">findActivityWidth</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> aw <span class="token operator">=</span> ActivityWidth<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token keyword">instanceof</span> <span class="token class-name">go<span class="token punctuation">.</span>Group</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// see if there is an Activity Node at this point -- if not, connect the link directly with the Group's lifeline</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token operator">!</span>node<span class="token punctuation">.</span>memberParts<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mem</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> act <span class="token operator">=</span> mem<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            <span class="token keyword">return</span> act <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> act<span class="token punctuation">.</span>start <span class="token operator">&lt;=</span> time <span class="token operator">&amp;&amp;</span> time <span class="token operator">&lt;=</span> act<span class="token punctuation">.</span>start <span class="token operator">+</span> act<span class="token punctuation">.</span>duration<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          aw <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> aw<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">getLinkDirection</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> port<span class="token punctuation">,</span> linkpoint<span class="token punctuation">,</span> spot<span class="token punctuation">,</span> from<span class="token punctuation">,</span> ortho<span class="token punctuation">,</span> othernode<span class="token punctuation">,</span> otherport</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> p <span class="token operator">=</span> port<span class="token punctuation">.</span><span class="token function">getDocumentPoint</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Center<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> op <span class="token operator">=</span> otherport<span class="token punctuation">.</span><span class="token function">getDocumentPoint</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Center<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> right <span class="token operator">=</span> op<span class="token punctuation">.</span>x <span class="token operator">&gt;</span> p<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
      <span class="token keyword">return</span> right <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">180</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">computePoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fromNode <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>toNode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// also handle a reflexive link as a simple orthogonal loop</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        <span class="token keyword">const</span> time <span class="token operator">=</span> data <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">?</span> data<span class="token punctuation">.</span>time <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">;</span> <span class="token comment">// if not bound, assume this has its own "time" property</span>
        <span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fromNode<span class="token punctuation">.</span>port<span class="token punctuation">.</span><span class="token function">getDocumentPoint</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Spot<span class="token punctuation">.</span>Center<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> aw <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findActivityWidth</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fromNode<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> x <span class="token operator">=</span> p<span class="token punctuation">.</span>x <span class="token operator">+</span> aw <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">convertTimeToY</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clearPoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">computePoints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// end MessageLink</span>

  <span class="token comment">// A custom LinkingTool that fixes the "time" (i.e. the Y coordinate)</span>
  <span class="token comment">// for both the temporaryLink and the actual newly created Link</span>
  <span class="token keyword">class</span> <span class="token class-name">MessagingTool</span> <span class="token keyword">extends</span> <span class="token class-name">go<span class="token punctuation">.</span>LinkingTool</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Since 2.2 you can also author concise templates with method chaining instead of GraphObject.make</span>
      <span class="token comment">// For details, see https://gojs.net/latest/intro/buildingObjects.html</span>
      <span class="token keyword">const</span> $ <span class="token operator">=</span> go<span class="token punctuation">.</span>GraphObject<span class="token punctuation">.</span>make<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>temporaryLink <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>MessageLink<span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token string">'Rectangle'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">'magenta'</span><span class="token punctuation">,</span> <span class="token literal-property property">strokeWidth</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">$</span><span class="token punctuation">(</span>go<span class="token punctuation">.</span>Shape<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">toArrow</span><span class="token operator">:</span> <span class="token string">'OpenTriangle'</span><span class="token punctuation">,</span> <span class="token literal-property property">stroke</span><span class="token operator">:</span> <span class="token string">'magenta'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">doActivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">doActivate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token function">convertYToTime</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>diagram<span class="token punctuation">.</span>firstInput<span class="token punctuation">.</span>documentPoint<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>temporaryLink<span class="token punctuation">.</span>time <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// round up to an integer value</span>
    <span class="token punctuation">}</span>

    <span class="token function">insertLink</span><span class="token punctuation">(</span><span class="token parameter">fromnode<span class="token punctuation">,</span> fromport<span class="token punctuation">,</span> tonode<span class="token punctuation">,</span> toport</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> newlink <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">insertLink</span><span class="token punctuation">(</span>fromnode<span class="token punctuation">,</span> fromport<span class="token punctuation">,</span> tonode<span class="token punctuation">,</span> toport<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>newlink <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>diagram<span class="token punctuation">.</span>model<span class="token punctuation">;</span>
        <span class="token comment">// specify the time of the message</span>
        <span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>temporaryLink<span class="token punctuation">.</span>time<span class="token punctuation">;</span>
        <span class="token keyword">const</span> duration <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        newlink<span class="token punctuation">.</span>data<span class="token punctuation">.</span>time <span class="token operator">=</span> start<span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setDataProperty</span><span class="token punctuation">(</span>newlink<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// and create a new Activity node data in the "to" group data</span>
        <span class="token keyword">const</span> newact <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">group</span><span class="token operator">:</span> newlink<span class="token punctuation">.</span>data<span class="token punctuation">.</span>to<span class="token punctuation">,</span>
          <span class="token literal-property property">start</span><span class="token operator">:</span> start<span class="token punctuation">,</span>
          <span class="token literal-property property">duration</span><span class="token operator">:</span> duration<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">addNodeData</span><span class="token punctuation">(</span>newact<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// now make sure all Lifelines are long enough</span>
        <span class="token function">ensureLifelineHeights</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> newlink<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// end MessagingTool</span>

  <span class="token comment">// A custom DraggingTool that supports dragging any number of MessageLinks up and down --</span>
  <span class="token comment">// changing their data.time value.</span>
  <span class="token keyword">class</span> <span class="token class-name">MessageDraggingTool</span> <span class="token keyword">extends</span> <span class="token class-name">go<span class="token punctuation">.</span>DraggingTool</span> <span class="token punctuation">{</span>
    <span class="token comment">// override the standard behavior to include all selected Links,</span>
    <span class="token comment">// even if not connected with any selected Nodes</span>
    <span class="token function">computeEffectiveCollection</span><span class="token punctuation">(</span><span class="token parameter">parts<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">computeEffectiveCollection</span><span class="token punctuation">(</span>parts<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// add a dummy Node so that the user can select only Links and move them all</span>
      result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Node</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>DraggingInfo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// normally this method removes any links not connected to selected nodes;</span>
      <span class="token comment">// we have to add them back so that they are included in the "parts" argument to moveParts</span>
      parts<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">part</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>part <span class="token keyword">instanceof</span> <span class="token class-name">go<span class="token punctuation">.</span>Link</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>part<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">go<span class="token punctuation">.</span>DraggingInfo</span><span class="token punctuation">(</span>part<span class="token punctuation">.</span><span class="token function">getPoint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// override to allow dragging when the selection only includes Links</span>
    <span class="token function">mayMove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>diagram<span class="token punctuation">.</span>isReadOnly <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>diagram<span class="token punctuation">.</span>allowMove<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// override to move Links (which are all assumed to be MessageLinks) by</span>
    <span class="token comment">// updating their Link.data.time property so that their link routes will</span>
    <span class="token comment">// have the correct vertical position</span>
    <span class="token function">moveParts</span><span class="token punctuation">(</span><span class="token parameter">parts<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> check</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">moveParts</span><span class="token punctuation">(</span>parts<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> check<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> it <span class="token operator">=</span> parts<span class="token punctuation">.</span>iterator<span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span>key <span class="token keyword">instanceof</span> <span class="token class-name">go<span class="token punctuation">.</span>Link</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> link <span class="token operator">=</span> it<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
          <span class="token keyword">const</span> startY <span class="token operator">=</span> it<span class="token punctuation">.</span>value<span class="token punctuation">.</span>point<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token comment">// DraggingInfo.point.y</span>
          <span class="token keyword">let</span> y <span class="token operator">=</span> startY <span class="token operator">+</span> offset<span class="token punctuation">.</span>y<span class="token punctuation">;</span> <span class="token comment">// determine new Y coordinate value for this link</span>
          <span class="token keyword">const</span> cellY <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gridSnapCellSize<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
          y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>y <span class="token operator">/</span> cellY<span class="token punctuation">)</span> <span class="token operator">*</span> cellY<span class="token punctuation">;</span> <span class="token comment">// snap to multiple of gridSnapCellSize.height</span>
          <span class="token keyword">const</span> t <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">convertYToTime</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          link<span class="token punctuation">.</span>diagram<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>link<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token string">'time'</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
          link<span class="token punctuation">.</span><span class="token function">invalidateRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// end MessageDraggingTool</span>

  <span class="token comment">// Show the diagram's model in JSON format</span>
  <span class="token keyword">function</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mySavedModel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> myDiagram<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myDiagram<span class="token punctuation">.</span>isModified <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    myDiagram<span class="token punctuation">.</span>model <span class="token operator">=</span> go<span class="token punctuation">.</span>Model<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'mySavedModel'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div>
  </body>
  </html>